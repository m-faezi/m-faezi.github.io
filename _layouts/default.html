
<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% seo %}
    <link rel="stylesheet" href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/carousel.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/expertise-tree.css' | relative_url }}">
    
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <style>
      /* Initial loading state */
      body {
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      
      body.loaded {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <!-- Background canvas -->
    <script src="{{ "/assets/js/background.js" | relative_url }}"></script>

    <div class="layout-wrapper">
      <!-- Modern Slim Sidebar -->
      <aside class="modern-sidebar">
        {% if site.avatar %}
        <img src="{{ site.avatar | relative_url }}" alt="{{ site.title }}" class="sidebar-avatar" />
        {% endif %}
        
        <!-- Social Links -->
        <div class="sidebar-social">
          {% if site.github_username %}
          <a href="https://github.com/{{ site.github_username }}" class="social-icon" aria-label="GitHub">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
          </a>
          {% endif %}
          {% if site.linkedin_username %}
          <a href="https://linkedin.com/in/{{ site.linkedin_username }}" class="social-icon" aria-label="LinkedIn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
          {% endif %}
          {% if site.google_scholar_user %}
          <a href="https://scholar.google.com/citations?user={{ site.google_scholar_user }}" class="social-icon" aria-label="Google Scholar">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M5.242 13.769L0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.749-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/>
            </svg>
          </a>
          {% endif %}
        </div>
      </aside>

      <!-- Main Content -->
      <div class="main-container">
        <!-- Modern Tab Navigation -->
        <div class="tab-container">
          <nav class="tab-nav">
            <button class="tab-button active" data-tab="home">Home</button>
            <button class="tab-button" data-tab="cv">CV</button>
            <button class="tab-button" data-tab="projects">Projects</button>
            <button class="tab-button" data-tab="publications">Publications</button>
            <button class="tab-button" data-tab="awards">Awards</button>
          </nav>
        </div>

        <!-- Tab Content Sections -->
        <div id="home" class="content-section active">
          <!-- Home content will be loaded dynamically -->
        </div>

        <div id="cv" class="content-section">
          <!-- CV content will be loaded dynamically -->
        </div>

        <div id="projects" class="content-section">
          <!-- Projects content will be loaded dynamically -->
        </div>

        <div id="publications" class="content-section">
          <!-- Publications content will be loaded dynamically -->
        </div>

        <div id="awards" class="content-section">
          <!-- Awards content will be loaded dynamically -->
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ "/assets/js/expertise-tree.js" | relative_url }}"></script>
    <script src="{{ "/assets/js/carousel.js" | relative_url }}"></script>
    
    <!-- Modern Navigation Script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Mark body as loaded
        document.body.classList.add('loaded');
        
        // Tab Navigation
        const tabButtons = document.querySelectorAll('.tab-button');
        const contentSections = document.querySelectorAll('.content-section');
        
        tabButtons.forEach(button => {
          button.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            // Update active tab
            tabButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Show selected content
            contentSections.forEach(section => {
              section.classList.remove('active');
              if (section.id === tabId) {
                section.classList.add('active');
              }
            });
            
            // Load content if not already loaded
            loadTabContent(tabId);
          });
        });
        
        // Function to load content from data files
        async function loadTabContent(tabId) {
          const section = document.getElementById(tabId);
          if (section && !section.dataset.loaded) {
            try {
              // Try to load from _data folder
              const response = await fetch(`/_data/${tabId}.yml`);
              if (response.ok) {
                const text = await response.text();
                // Extract content after "content: |"
                const contentMatch = text.match(/content:\s*\|\s*\n([\s\S]*)/);
                if (contentMatch) {
                  section.innerHTML = contentMatch[1];
                  section.dataset.loaded = true;
                  initializeComponents(tabId);
                }
              } else {
                // Fallback to markdown files
                const pageResponse = await fetch(`/${tabId}.md`);
                if (pageResponse.ok) {
                  const pageText = await pageResponse.text();
                  // Extract content between --- markers (remove front matter)
                  const content = pageText.split('---').slice(2).join('---').trim();
                  section.innerHTML = content;
                  section.dataset.loaded = true;
                  initializeComponents(tabId);
                } else {
                  // Show fallback message
                  section.innerHTML = `<div class="compact-card"><p>Content for ${tabId} is coming soon...</p></div>`;
                  section.dataset.loaded = true;
                }
              }
            } catch (error) {
              console.error(`Error loading ${tabId}:`, error);
              section.innerHTML = `<div class="compact-card"><p>Unable to load ${tabId} content. Please try again later.</p></div>`;
            }
          }
        }
        
        // Initialize components based on tab
        function initializeComponents(tabId) {
          // Initialize carousel for home and projects tabs
          if ((tabId === 'home' || tabId === 'projects') && 
              document.querySelector('#projectsCarousel') && 
              window.ProjectCarousel) {
            setTimeout(() => {
              new window.ProjectCarousel('projectsCarousel', {
                autoSlideDelay: 4000,
              });
            }, 300);
          }
          
          // Initialize expertise tree for home tab
          if (tabId === 'home' && 
              document.querySelector('#expertiseTree') && 
              window.ExpertiseTree && 
              window.expertiseData) {
            setTimeout(() => {
              new window.ExpertiseTree('expertiseTree', window.expertiseData);
            }, 300);
          }
          
          // Add fade-in animation to loaded content
          const section = document.getElementById(tabId);
          if (section) {
            section.classList.add('fade-in');
          }
        }
        
        // Load initial tab content
        loadTabContent('home');
        
        // Preload other tabs in background
        ['cv', 'projects', 'publications', 'awards'].forEach(tab => {
          setTimeout(() => loadTabContent(tab), 1000);
        });
        
        // Smooth scroll for anchor links
        document.addEventListener('click', function(e) {
          if (e.target.matches('a[href^="#"]')) {
            e.preventDefault();
            const targetId = e.target.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          }
        });
        
        // Parallax effect for sidebar
        window.addEventListener('scroll', function() {
          const sidebar = document.querySelector('.modern-sidebar');
          if (sidebar && window.innerWidth > 768) {
            const scrollY = window.scrollY;
            sidebar.style.transform = `translateY(calc(-50% + ${scrollY * 0.1}px))`;
          }
        });
        
        // Responsive sidebar behavior
        function handleResize() {
          const sidebar = document.querySelector('.modern-sidebar');
          if (window.innerWidth <= 768) {
            // Mobile: sidebar at bottom
            if (sidebar) {
              sidebar.style.transform = 'translateX(-50%)';
            }
          } else {
            // Desktop: sidebar vertical with parallax
            if (sidebar) {
              const scrollY = window.scrollY;
              sidebar.style.transform = `translateY(calc(-50% + ${scrollY * 0.1}px))`;
            }
          }
        }
        
        window.addEventListener('resize', handleResize);
        handleResize(); // Initial call
        
        // Keyboard navigation for tabs
        document.addEventListener('keydown', function(e) {
          if (e.altKey) {
            const currentTab = document.querySelector('.tab-button.active');
            if (currentTab) {
              const tabs = Array.from(tabButtons);
              const currentIndex = tabs.indexOf(currentTab);
              
              if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                // Next tab
                const nextIndex = (currentIndex + 1) % tabs.length;
                tabs[nextIndex].click();
                e.preventDefault();
              } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                // Previous tab
                const prevIndex = (currentIndex - 1 + tabs.length) % tabs.length;
                tabs[prevIndex].click();
                e.preventDefault();
              }
            }
          }
        });
        
        // Add loading indicator while content loads
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'childList') {
              // Add slide-up animation to new content
              mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === 1) { // Element node
                  node.classList.add('slide-up');
                }
              });
            }
          });
        });
        
        // Observe all content sections
        contentSections.forEach(section => {
          observer.observe(section, { childList: true });
        });
        
        // Log initialization
        console.log('Modern UI initialized successfully');
      });
    </script>
  </body>
</html>


